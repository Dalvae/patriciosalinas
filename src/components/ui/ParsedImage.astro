---
import { JSDOM } from "jsdom";
import ProtectedImage from "./ProtectedImage.astro";

interface Props {
  content: string;
}

const { content } = Astro.props;

function extractImageAttributes(content: string) {
  const dom = new JSDOM(content);
  const doc = dom.window.document;
  const img = doc.querySelector("img");
  if (img) {
    return {
      src: img.getAttribute("src") || "",
      alt: img.getAttribute("alt") || "",
      width: img.getAttribute("width") || "100%",
      height: img.getAttribute("height") || "auto",
    };
  }
  return null;
}

const imageAttributes = extractImageAttributes(content);
---

{
  imageAttributes ? (
    <ProtectedImage
      src={imageAttributes.src}
      alt={imageAttributes.alt}
      width={imageAttributes.width}
      height={imageAttributes.height}
    />
  ) : (
    <div set:html={content} />
  )
}
