---
import type { Page, Post, Lang } from "../types/types";
import { getLangFromUrl, useTranslations } from "../i18n/utils";
import { languages } from "../i18n/ui";
import { getPages, getPosts } from "../lib/graphql-queries";

export interface Props {
  currentPath: string;
}

const { currentPath } = Astro.props;
const lang = getLangFromUrl(Astro.url) as Lang;
const t = useTranslations(lang);

// Fetch pages and posts
const pages = await getPages(lang);
const posts = await getPosts(lang);

function getItemLink(item: Page | Post, type: "page" | "post"): string {
  if (item.uri === `/${lang}/`) return `/${lang}`;
  return item.uri; // Simplemente devuelve la URI tal como viene de WordPress
}
function isCurrentItem(itemUri: string): boolean {
  return (
    currentPath === itemUri ||
    (currentPath === `/${lang}` && itemUri === `/${lang}`)
  );
}
---

<nav>
  <ul>
    <li>
      <a href={`/${lang}`} class={isCurrentItem("/") ? "active" : ""}>
        {t("nav.home")}
      </a>
    </li>
    {
      pages.map((item) => (
        <li>
          <a
            href={getItemLink(item, "page")}
            class={isCurrentItem(item.uri) ? "active" : ""}
          >
            {item.title}
          </a>
        </li>
      ))
    }
    <li>
      <a href="#" class="dropdown-toggle">
        {/* Agrega una clase para el estilo del dropdown */}
        {t("nav.blog")}
      </a>
      <ul class="dropdown-menu">
        {/* Agrega una clase para el estilo del dropdown */}
        {
          posts.map((post) => (
            <li>
              <a href={getItemLink(post, "post")}>{post.title}</a>
            </li>
          ))
        }
      </ul>
    </li>
    <li>
      <a
        href={`/${lang}/blog`}
        class={currentPath.startsWith(`/${lang}/blog`) ? "active" : ""}
      >
        {t("nav.blog")}
      </a>
    </li>
  </ul>
  <div class="language-switcher">
    {
      Object.entries(languages).map(([code, label]) => (
        <a href={`/${code}`} class={lang === code ? "active" : ""}>
          {label}
        </a>
      ))
    }
  </div>
</nav>

<style>
  nav {
    background-color: #f8f9fa;
    padding: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  ul {
    list-style-type: none;
    padding: 0;
    display: flex;
    gap: 1rem;
  }
  a {
    text-decoration: none;
    color: #333;
    font-weight: bold;
  }
  a:hover,
  a.active {
    color: #007bff;
  }
  .language-switcher {
    display: flex;
    gap: 0.5rem;
  }
  .language-switcher a {
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    background-color: #e9ecef;
  }
  .language-switcher a.active {
    background-color: #007bff;
    color: white;
  }
</style>
