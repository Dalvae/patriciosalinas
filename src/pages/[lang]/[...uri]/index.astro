---
import Layout from "../../../layouts/Layout.astro";
import { getPages } from "../../../lib/graphql-queries";
import type { Lang } from "../../../types/types";
import PageContent from "../../../components/PageContent.astro";
import { useTranslations } from "../../../i18n/utils";

export async function getStaticPaths() {
  const languages: Lang[] = ["en", "es", "sv"];

  return Promise.all(
    languages.map(async (lang) => {
      const pages = await getPages(lang);

      return pages
        .filter((page) => !page.isFrontPage)
        .map((page) => ({
          params: {
            lang,
            uri: page.uri.split("/").slice(2).join("/"),
          },
          props: { pages, page },
        }));
    })
  ).then((results) => results.flat());
}

const { lang } = Astro.params as { lang: Lang };
const { pages, page } = Astro.props;
const t = useTranslations(lang);
---

<Layout title={page.title} lang={lang} pages={pages}>
  <PageContent lang={lang} uri={page.uri} page={page} />
</Layout>
