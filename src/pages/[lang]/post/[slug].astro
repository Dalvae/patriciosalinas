---
import PostPage from "../../../components/PostPage.astro";
import { getPosts } from "../../../lib/graphql-queries";
import type { Lang } from "../../../types/types";

export async function getStaticPaths() {
  const languages: Lang[] = ["en", "es", "sv"]; // Add all supported languages here

  const allPaths = await Promise.all(
    languages.map(async (lang) => {
      const posts = await getPosts(lang);
      return posts
        .map((post) => {
          if (!post.uri || typeof post.uri !== "string") {
            console.warn(
              `Post with ID ${post.id} has an invalid or missing URI. Skipping...`
            );
            return null;
          }

          const pathParts = post.uri.split("/").filter(Boolean);
          const slug = pathParts.length > 1 ? pathParts[1] : null;

          if (slug === null) {
            return null;
          }

          return {
            params: { lang, slug },
          };
        })
        .filter(Boolean);
    })
  );

  return allPaths.flat();
}

const { lang, slug } = Astro.params;
---

<PostPage lang={lang} slug={slug} />
