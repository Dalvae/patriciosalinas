---
//src/pages/index.astro
export const prerender = false;

function getBrowserLanguage(accept: string | null): string {
  if (!accept) return "en";

  const languages = ["en", "es", "sv"];
  const browserPreferences = accept
    .split(",")
    .map((lang) => lang.trim().toLowerCase().split("-")[0]);

  for (const pref of browserPreferences) {
    if (languages.includes(pref)) {
      return pref;
    }
  }

  return "en";
}

const acceptLanguage = Astro.request.headers.get("accept-language");
const detectedLanguage = getBrowserLanguage(acceptLanguage);
console.log("Detected language:", detectedLanguage);
return Astro.redirect(`/${detectedLanguage}`);
---

<meta http-equiv="refresh" content={`0;url=/${detectedLanguage}`} />
